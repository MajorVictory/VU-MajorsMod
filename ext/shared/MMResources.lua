class "MMResources"

function MMResources:__init()
	self.MMResources = {}

	self.MMResources["magnum44"] = {}
	self.MMResources["magnum44"]["Partition"] = '21E91507-2AF6-11E0-9848-9E9BC51DCED8'
	self.MMResources["magnum44"]["Instance"] = 'B6CD5488-67E6-4063-8594-A09DAA2640F3'

	self.MMResources["smaw"] = {}
	self.MMResources["smaw"]["Partition"] = '168F529B-17F6-11E0-8CD8-85483A75A7C5'
	self.MMResources["smaw"]["Instance"] = '168F529C-17F6-11E0-8CD8-85483A75A7C5'

	self.MMResources["p90"] = {}
	self.MMResources["p90"]["Partition"] = 'C75DBA86-F326-11DF-ABE6-A89858BEBE43'
	self.MMResources["p90"]["Instance"] = '9629652F-135E-4EE6-A9FB-343D947A4861'

	self.MMResources["c4"] = {}
	self.MMResources["c4"]["Partition"] = '90D317AC-2554-11E0-9BE1-9E3A551FF0D1'
	self.MMResources["c4"]["Instance"] = '6CF717B6-188A-4AE7-A1D2-CC1A2333C0D7'

	self.MMResources["c4exp"] = {}
	self.MMResources["c4exp"]["Partition"] = '910AD7C5-2558-11E0-96DC-FF63A5537869'
	self.MMResources["c4exp"]["Instance"] = '5FE6E2AD-072E-4722-984A-5C52BC66D4C1'

	self.MMResources["c4expentity"] = {}
	self.MMResources["c4expentity"]["Partition"] = '910AD7C5-2558-11E0-96DC-FF63A5537869'
	self.MMResources["c4expentity"]["Instance"] = '09DCA5BB-BB2E-4EC6-B07F-5F74863EB458'

	self.MMResources["m15"] = {}
	self.MMResources["m15"]["Partition"] = 'B38C8E78-EBE6-11DF-8768-F4F1C9378C27'
	self.MMResources["m15"]["Instance"] = 'D1110C87-5913-43A4-A47F-04AD47B0C611'

	self.MMResources["m15exp"] = {}
	self.MMResources["m15exp"]["Partition"] = '49F4451D-D64E-45E5-BC96-B39CE8BC4D10'
	self.MMResources["m15exp"]["Instance"] = 'EA440D5D-925C-4239-8463-4FE3EAD30C5F'

	self.MMResources["m15expentity"] = {}
	self.MMResources["m15expentity"]["Partition"] = '49F4451D-D64E-45E5-BC96-B39CE8BC4D10'
	self.MMResources["m15expentity"]["Instance"] = 'D936971A-354B-49B7-BCCA-4FE01B68D395'


	self.MMResources["bullet338"] = {}
	self.MMResources["bullet338"]["Partition"] = '2056BCC7-3769-458C-8C0E-BB6280DF360C'
	self.MMResources["bullet338"]["Instance"] = '1BF6EA67-2EFE-4B93-9558-0B3B38862E1F'

	self.MMResources["m98"] = {}
	self.MMResources["m98"]["Partition"] = '84BA0CE7-1755-11E0-B7E4-E4E608316920'
	self.MMResources["m98"]["Instance"] = '7805C312-2B2B-49C6-B1A9-F6A99863BA3E'

	self.MMResources["aek971"] = {}
	self.MMResources["aek971"]["Partition"] = '64DB81AD-1F08-11E0-BE14-C6BC4F4ED27B'
	self.MMResources["aek971"]["Instance"] = 'CE3372DA-991B-41C1-95BC-19B5D26AAE5B'


	self.MMResources["playerphys"] = {}
	self.MMResources["playerphys"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	self.MMResources["playerphys"]["Instance"] = 'A10FF2AA-F3CF-416B-A79B-E8C5416A9EBC'

	self.MMResources["yump"] = {}
	self.MMResources["yump"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	self.MMResources["yump"]["Instance"] = '3129BCFE-000E-4001-9F8F-316E5835C9FC'

	self.MMResources["m1abrams"] = {}
	self.MMResources["m1abrams"]["Partition"] = 'B069BA89-EECF-11DD-8117-9421284A74E5'
	self.MMResources["m1abrams"]["Instance"] = 'BE4ECA89-2682-4F0B-BA0A-5CECD4D25722'

	self.MMResources["m1abramsshot"] = {}
	self.MMResources["m1abramsshot"]["Partition"] = 'D684EC68-0FE9-4DF1-A732-9279BBA202F8'
	self.MMResources["m1abramsshot"]["Instance"] = 'AB939926-0BAF-6C4F-22D8-6074F0D78EF9'

	self.MMResources["m1abramsshell"] = {}
	self.MMResources["m1abramsshell"]["Partition"] = 'D684EC68-0FE9-4DF1-A732-9279BBA202F8'
	self.MMResources["m1abramsshell"]["Instance"] = 'F8903680-77AE-4D0C-88B7-88E5407CE897'

	self.MMResources["m1abramsengine"] = {}
	self.MMResources["m1abramsengine"]["Partition"] = 'B069BA89-EECF-11DD-8117-9421284A74E5'
	self.MMResources["m1abramsengine"]["Instance"] = 'B06A08CE-EECF-11DD-8117-9421284A74E5'

	self.MMResources["m1abramswheel"] = {}
	self.MMResources["m1abramswheel"]["Partition"] = 'B069BA89-EECF-11DD-8117-9421284A74E5'
	self.MMResources["m1abramswheel"]["Instance"] = 'B06A08B3-EECF-11DD-8117-9421284A74E5'

	self.MMResources["mbtcannon"] = {}
	self.MMResources["mbtcannon"]["Partition"] = 'B069BA89-EECF-11DD-8117-9421284A74E5'
	self.MMResources["mbtcannon"]["Instance"] = 'B06A0931-EECF-11DD-8117-9421284A74E5'

	self.MMResources["t90shell"] = {}
	self.MMResources["t90shell"]["Partition"] = 'E25400E3-4E66-31A4-D991-6E56084F10FF'
	self.MMResources["t90shell"]["Instance"] = '36F86B49-A702-ED77-ACEC-015732F289E6'

	self.MMResources["t90shot"] = {}
	self.MMResources["t90shot"]["Partition"] = 'E25400E3-4E66-31A4-D991-6E56084F10FF'
	self.MMResources["t90shot"]["Instance"] = 'AB939926-0BAF-6C4F-22D8-6074F0D78EF9'

	self.MMResources["t90impact"] = {}
	self.MMResources["t90impact"]["Partition"] = 'E25400E3-4E66-31A4-D991-6E56084F10FF'
	self.MMResources["t90impact"]["Instance"] = '9B15C366-BBB8-B65C-6AEE-62C5F5703271'

	self.MMResources["t90impactsplash"] = {}
	self.MMResources["t90impactsplash"]["Partition"] = 'E25400E3-4E66-31A4-D991-6E56084F10FF'
	self.MMResources["t90impactsplash"]["Instance"] = 'CE7AC4AB-83B2-188B-3BAB-3F035BA5857A'


	self.MMResources["humvee"] = {}
	self.MMResources["humvee"]["Partition"] = '611F48A3-0919-11E0-985D-C512734E48AF'
	self.MMResources["humvee"]["Instance"] = '34ADD228-7E03-C4A4-665F-E0F0955098EE'

	self.MMResources["humveeengine"] = {}
	self.MMResources["humveeengine"]["Partition"] = '611F48A3-0919-11E0-985D-C512734E48AF'
	self.MMResources["humveeengine"]["Instance"] = '7ED9EDBE-034C-4CEE-9BA0-EFAB0698E167'

	self.MMResources["humveehorn"] = {}
	self.MMResources["humveehorn"]["Partition"] = '611F48A3-0919-11E0-985D-C512734E48AF'
	self.MMResources["humveehorn"]["Instance"] = 'EEC68041-9AF5-497B-94C4-B576D8A033C0'


	self.MMResources["growlerengine"] = {}
	self.MMResources["growlerengine"]["Partition"] = 'CF5166FD-6B60-11E0-8ACE-C75FA07B1C42'
	self.MMResources["growlerengine"]["Instance"] = 'FCE0343A-4366-4C12-A139-381585552777'

	self.MMResources["growlerhorn"] = {}
	self.MMResources["growlerhorn"]["Partition"] = 'CF5166FD-6B60-11E0-8ACE-C75FA07B1C42'
	self.MMResources["growlerhorn"]["Instance"] = '4C6B9387-C2FC-40BA-BDC0-E79B70A817BB'

	self.MMResources["growlerwheelsfront"] = {}
	self.MMResources["growlerwheelsfront"]["Partition"] = 'CF5166FD-6B60-11E0-8ACE-C75FA07B1C42'
	self.MMResources["growlerwheelsfront"]["Instance"] = '1564DF08-243A-488A-8C01-8D63CA647FED'

	self.MMResources["growlerwheelsback"] = {}
	self.MMResources["growlerwheelsback"]["Partition"] = 'CF5166FD-6B60-11E0-8ACE-C75FA07B1C42'
	self.MMResources["growlerwheelsback"]["Instance"] = '1460C730-CB73-4BD4-B558-C1F1D4FE5C01'

	self.MMResources["m1128engine"] = {}
	self.MMResources["m1128engine"]["Partition"] = '3EE37540-9833-11E1-A26B-A2AC6EC60B20'
	self.MMResources["m1128engine"]["Instance"] = 'FD6D9474-0F4E-483A-943D-16C6FF949545'


	self.MMResources["ah6engine"] = {}
	self.MMResources["ah6engine"]["Partition"] = 'FD8AB747-FF4D-11DD-A7B1-F7C6DEEC9D32'
	self.MMResources["ah6engine"]["Instance"] = '15AB2B27-FF4E-11DD-A7B1-F7C6DEEC9D32'

	self.MMResources["ah6rotors"] = {}
	self.MMResources["ah6rotors"]["Partition"] = 'FD8AB747-FF4D-11DD-A7B1-F7C6DEEC9D32'
	self.MMResources["ah6rotors"]["Instance"] = '15AB2B28-FF4E-11DD-A7B1-F7C6DEEC9D32'


	self.MMResources["pose_stand"] = {}
	self.MMResources["pose_stand"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	self.MMResources["pose_stand"]["Instance"] = '69A866A2-DF7C-4BAD-B55F-99536F2551F6'
	--self.MMResources["pose_crouch"] = {}
	--self.MMResources["pose_crouch"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	--self.MMResources["pose_crouch"]["Instance"] = '79C79DFB-769E-4B4E-A279-CBA6732C85A5'
	--self.MMResources["pose_prone"] = {}
	--self.MMResources["pose_prone"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	--self.MMResources["pose_prone"]["Instance"] = '173494FC-694C-40C7-99CE-271FEAB63E69'


	self.MMResources["pose_standair"] = {}
	self.MMResources["pose_standair"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	self.MMResources["pose_standair"]["Instance"] = 'DF7475F9-216E-48C3-AED1-5483EFA3BB15'
	--self.MMResources["pose_crouchair"] = {}
	--self.MMResources["pose_crouchair"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	--self.MMResources["pose_crouchair"]["Instance"] = '22764197-C64C-4E48-940C-6E1BD38FDEE7'
	--self.MMResources["pose_proneair"] = {}
	--self.MMResources["pose_proneair"]["Partition"] = '235CD1DA-8B06-4A7F-94BE-D50DA2D077CE'
	--self.MMResources["pose_proneair"]["Instance"] = '0CD1E94C-7E21-42EF-816E-0B5657FE1676'


	self.MMResources["ammobag"] = {}
	self.MMResources["ammobag"]["Partition"] = '04CD683B-1F1B-11E0-BBD1-F7235575FD24'
	self.MMResources["ammobag"]["Instance"] = '4AE515CE-846D-6070-5F56-1285B7E8E187'

	self.MMResources["a10"] = {}
	self.MMResources["a10"]["Partition"] = 'D07E3830-85FD-4C0E-819E-23640D2B2ECB'
	self.MMResources["a10"]["Instance"] = '46B31051-405C-40E0-A7F0-62283823CC7C'
	self.MMResources["a10"]["Blueprints"] = {
		'CC50390A-A29A-0C75-33A0-36DEDCFD0DA8', -- A-10_THUNDERBOLT_WingTipLeft
		'B3E9860F-EE10-44F3-B4DC-5730BE251159', -- A-10_THUNDERBOLT
		'66D8092F-AAC9-CD4B-C906-D0EACBFA4CF0', -- A-10_THUNDERBOLT_WreckTail
		'3E66EB3E-6984-18D4-3AFB-F8ED7EFBEA8F', -- A-10_THUNDERBOLT_WingTipRight
		'44C82567-14E3-48DA-BB9A-104D57CA1546', -- A-10_THUNDERBOLT_WreckBody
		'FD0A16D5-E92A-C4EE-52BC-19BC622E409D' -- A-10_THUNDERBOLT_WreckFront
	}
	self.MMResources["a10"]["Entities"] = {
		'FDCA8108-7A40-11E0-AC6E-B8454A26D179', -- A-10_THUNDERBOLT_WreckTail
		'EB482D1E-7A40-11E0-AC6E-B8454A26D179', -- A-10_THUNDERBOLT_WreckBody
		'46B31051-405C-40E0-A7F0-62283823CC7C', -- A10_THUNDERBOLT
		'14E8A763-E3D0-4131-BBC3-8BD2B5581FB3', -- A10_THUNDERBOLT
		'2DCB8669-210A-4E82-AF2B-B84173CE9622', -- A10_THUNDERBOLT
		'D85CB473-7A40-11E0-AC6E-B8454A26D179', -- A-10_THUNDERBOLT_WreckFront
		'86C1CA84-3179-4FA1-9F1A-6BB13EF14FE0', -- A10_THUNDERBOLT
		'93B4369E-7B30-11E0-A197-B95FBA46DD5F', -- A-10_THUNDERBOLT_WingTipRight
		'BA5EE5A4-A1A3-4914-84FD-10D99C2685F4', -- A10_THUNDERBOLT
		'521F87C0-F67D-4DB7-82F5-9653584098F2', -- A10_THUNDERBOLT
		'7555A6CF-FB4B-4285-9D2A-FEC678F7A713', -- A10_THUNDERBOLT
		'76B634E2-7B30-11E0-A197-B95FBA46DD5F', -- A-10_THUNDERBOLT_WingTipLeft
		'2F5148E7-A5B4-4C1C-A3FE-1BE3419571EC', -- A10_THUNDERBOLT
		'C9AD39F3-8B65-47F4-AC7C-60737990B6DF' -- A10_THUNDERBOLT
	}
	self.MMResources["a10"]["LogicReferrence"] = {
		'8FBCD462-B87C-465F-91D4-658D992CC8FD', -- A10_THUNDERBOLT
		'74311DF0-1047-47DD-9920-DF09857ADD2E' -- A10_THUNDERBOLT
	}

	self.MMResources["a10_bullets"] = {}
	self.MMResources["a10_bullets"]["Partition"] = '71B9175E-431B-405F-8E7A-6CA6745BEE47'
	self.MMResources["a10_bullets"]["Instance"] = '79D9D672-27CC-433A-AB04-86B07F2F73CE'

	self.MMResources["civcar03"] = {}
	self.MMResources["civcar03"]["Partition"] = '1A52E780-FEF6-11DF-B32D-B2D8A97C362D'
	self.MMResources["civcar03"]["Instance"] = '4547A158-030C-B7B4-9043-4ADB726FAF8C'
	self.MMResources["civcar03"]["Blueprints"] = {
		'4547A158-030C-B7B4-9043-4ADB726FAF8C',
		'9A02F5D2-33F2-11DE-99D3-98DCCAF38B4D'
	}
	self.MMResources["civcar03"]["Entities"] = {'8C7B446F-8BBC-780F-F25B-4328A7BC2303'}

	self.MMResources["civcar03engine"] = {}
	self.MMResources["civcar03engine"]["Partition"] = '1A52E780-FEF6-11DF-B32D-B2D8A97C362D'
	self.MMResources["civcar03engine"]["Instance"] = '12F45D91-4D34-49C6-897F-2EB8ECA9F070'

	self.MMResources["simplecarenginesound"] = {}
	self.MMResources["simplecarenginesound"]["Partition"] = '3203023E-4A22-4B10-9698-E994174BF557'
	self.MMResources["simplecarenginesound"]["Instance"] = '509CCE6F-7363-441E-A062-71419DCFD50E'

	self.MMResources["deliveryvan"] = {}
	self.MMResources["deliveryvan"]["Partition"] = 'FF60B55F-7BEA-11E0-B9A5-818EB3538184'
	self.MMResources["deliveryvan"]["Instance"] = '74D984EC-29FD-365A-5052-41E81AFB6DEC'
	self.MMResources["deliveryvan"]["Blueprints"] = {'74D984EC-29FD-365A-5052-41E81AFB6DEC'}
	self.MMResources["deliveryvan"]["Entities"] = {'2CB916D5-51C6-18BC-7685-3E417DE1C48F'}


	self.SturdifyBlacklist = {}
	self.SturdifyBlacklist["18178664-DDBD-55C8-8D69-3E05030CA399"] = true -- T-UGS_Vehicle
	self.SturdifyBlacklist["3F6D23B3-9520-F810-1F95-1CE64C22B30C"] = true -- SOFLAM
	self.SturdifyBlacklist["C6248092-D0A7-EB93-F1E4-B5405F370180"] = true -- MAV
	self.SturdifyBlacklist["DBE1A4B1-EF7B-4F22-7737-848A88968D7F"] = true -- RadioBeacon_Projectile
	self.SturdifyBlacklist["D9183C94-D7DC-9809-30CA-721793BB2E04"] = true -- AGM-144_Hellfire_TV
	self.SturdifyBlacklist["CRAM"] = true
	self.SturdifyBlacklist["Kornet"] = true
	self.SturdifyBlacklist["TOW"] = true
	self.SturdifyBlacklist["GUNSHIP"] = true

	for resourceName, resourceData in pairs(self.MMResources) do
		self.MMResources[resourceName].Loaded = false
	end
end



function MMResources:IsLoaded(resourceName)
	if not self.MMResources[resourceName] then
		print("Tried to check unregistered resource: "..tostring(resourceName))
		return false
	else
		return self.MMResources[resourceName]["Loaded"]
	end
end

function MMResources:SetLoaded(resourceName, value)
	if not self.MMResources[resourceName] then
		print("Tried to set unregistered resource: "..tostring(resourceName))
	else
		self.MMResources[resourceName]["Loaded"] = value
	end
end

function MMResources:Get(resourceName)
	if (resourceName ~= nil) then
		return self.MMResources[resourceName]
	else
		return self.MMResources
	end
end

function MMResources:GetPartition(resourceName)
	return ResourceManager:FindDatabasePartition(Guid(self.MMResources[resourceName].Partition))
end

function MMResources:GetInstance(resourceName)
	return ResourceManager:FindInstanceByGuid(Guid(self.MMResources[resourceName].Partition), Guid(self.MMResources[resourceName].Instance))
end

function MMResources:AddToPartition(resourceName, partition)
	if not self.MMResources[resourceName] then
		print("Tried to add unregistered resource to partition: "..tostring(resourceName))
		return
	end

    print('Adding '..resourceName..' instances to partition...')
	local resourceData = self.MMResources[resourceName]

	if (resourceData.Entities) then
        print("Adding Entities...")
        for i = 1, #resourceData.Entities do
            local res = ResourceManager:SearchForInstanceByGuid(Guid(resourceData.Entities[i]))
            if (res) then
                print("["..i.."] Added: "..res.typeInfo.name)
                partition:AddInstance(res)
            else
                print("["..i.."] Failed: "..resourceData.Entities[i])
            end
        end
    end
    if (resourceData.Blueprints) then
        print("Adding Blueprints...")
        for i = 1, #resourceData.Blueprints do
            local res = ResourceManager:SearchForInstanceByGuid(Guid(resourceData.Blueprints[i]))
            if (res) then
                print("["..i.."] Added: "..res.typeInfo.name)
                partition:AddInstance(res)
            else
                print("["..i.."] Failed: "..resourceData.Blueprints[i])
            end
        end
    end
    if (resourceData.LogicReferrence) then
        print("Adding Logic Referrences...")
        for i = 1, #resourceData.LogicReferrence do
            local res = ResourceManager:SearchForInstanceByGuid(Guid(resourceData.LogicReferrence[i]))
            if (res) then
                print("["..i.."] Added: "..res.typeInfo.name)
                partition:AddInstance(res)
            else
                print("["..i.."] Failed: "..resourceData.LogicReferrence[i])
            end
        end
    end
end

function MMResources:CreateRegistryContainer()
	local resourceContainer = RegistryContainer()
    
    print('Adding instances to registry')

    for resourceName, resourceData in pairs(self.MMResources) do
        if (resourceData.Entities) then
            print("Adding Entities ["..resourceName.."]...")
            for i = 1, #resourceData.Entities do
                local res = ResourceManager:SearchForInstanceByGuid(Guid(resourceData.Entities[i]))
                if (res) then
                    print("["..i.."] Added: "..res.typeInfo.name)
                    resourceContainer.entityRegistry:add(res)
                else
                    print("["..i.."] Failed: "..resourceData.Entities[i])
                end
            end
        end
        if (resourceData.Blueprints) then
            print("Adding Blueprints ["..resourceName.."]...")
            for i = 1, #resourceData.Blueprints do
                local res = ResourceManager:SearchForInstanceByGuid(Guid(resourceData.Blueprints[i]))
                if (res) then
                    print("["..i.."] Added: "..res.typeInfo.name)
                    resourceContainer.blueprintRegistry:add(res)
                else
                    print("["..i.."] Failed: "..resourceData.Blueprints[i])
                end
            end
        end
        if (resourceData.LogicReferrence) then
            print("Adding Logic Referrences ["..resourceName.."]...")
            for i = 1, #resourceData.LogicReferrence do
                local res = ResourceManager:SearchForInstanceByGuid(Guid(resourceData.LogicReferrence[i]))
                if (res) then
                    print("["..i.."] Added: "..res.typeInfo.name)
                    resourceContainer.referenceObjectRegistry:add(res)
                else
                    print("["..i.."] Failed: "..resourceData.LogicReferrence[i])
                end
            end
        end
    end
    return resourceContainer
end


function MMResources:IsSturdifyBlacklisted(instance)
	if (instance:Is('VehicleEntityData')) then
		local vehicleData = VehicleEntityData(instance)

		return (self.SturdifyBlacklist[instance.instanceGuid:ToString('D')] == true or vehicleData.nameSid == '' or self.SturdifyBlacklist[vehicleData.nameSid] == true)
	else
		return self.SturdifyBlacklist[instance.instanceGuid:ToString('D')] == true
	end
end

return MMResources()